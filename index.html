<html>
<head>
<meta charset="utf-8" />
<title>Leaflet OSM Karte</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  #map {
    height: 100vh;
    width: 100vw;
  }
  .delete-btn {
    margin-top: 10px;
    display: inline-block;
    padding: 5px 10px;
    background: #d9534f;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
  }
</style>

</head>
<body>

<div id="map"></div>

<script>
// -------------------------------------------------
// Karte laden
// -------------------------------------------------
var map = L.map('map').setView([51.5, 10.0], 6);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap-Mitwirkende'
}).addTo(map);

// -------------------------------------------------
// Marker-Speicher
// -------------------------------------------------
var savedMarkers = JSON.parse(localStorage.getItem("markers") || "[]");
var markerObjects = [];

// -------------------------------------------------
// Marker erstellen
// -------------------------------------------------
function createMarker(lat, lng, popupHtml, saveToStorage = false) {

    var marker = L.marker([lat, lng]).addTo(map);

    // Popup mit Button-Container
    var popupContent = document.createElement("div");
    popupContent.innerHTML = popupHtml;

    var deleteBtn = document.createElement("div");
    deleteBtn.className = "delete-btn";
    deleteBtn.textContent = "ðŸ—‘ Marker lÃ¶schen";

    deleteBtn.addEventListener("click", function () {
        deleteMarker(marker, lat, lng);
    });

    popupContent.appendChild(deleteBtn);

    marker.bindPopup(popupContent);

    markerObjects.push({ marker: marker, lat: lat, lng: lng });

    if (saveToStorage) {
        savedMarkers.push({ lat: lat, lng: lng, popup: popupHtml });
        localStorage.setItem("markers", JSON.stringify(savedMarkers));
    }
}

// -------------------------------------------------
// Marker lÃ¶schen
// -------------------------------------------------
function deleteMarker(marker, lat, lng) {
    if (!confirm("Marker wirklich lÃ¶schen?")) return;

    // Entfernen von der Karte
    map.removeLayer(marker);

    // Aus Speicher entfernen
    savedMarkers = savedMarkers.filter(m => !(m.lat === lat && m.lng === lng));
    localStorage.setItem("markers", JSON.stringify(savedMarkers));
}

// -------------------------------------------------
// Gespeicherte Marker wiederherstellen
// -------------------------------------------------
savedMarkers.forEach(function (m) {
    createMarker(m.lat, m.lng, m.popup);
});

// -------------------------------------------------
// Klick â†’ neuen Marker setzen
// -------------------------------------------------
map.on("click", function (e) {
    var text = prompt("Text fÃ¼r die Markierung eingeben:");
    if (!text) return;

    var imgUrl = prompt("Bild-URL eingeben (optional):");

    var popupHtml = "<b>" + text + "</b>";
    if (imgUrl) popupHtml += "<br><img src='" + imgUrl + "' width='200'>";

    createMarker(e.latlng.lat, e.latlng.lng, popupHtml, true);
});
</script>

</body>
</html>
